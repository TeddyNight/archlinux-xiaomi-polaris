From b78aecde5aa6f9ecea082f9d44c7df6ee8ba05a6 Mon Sep 17 00:00:00 2001
From: teddynight <tanyuliang2@gmail.com>
Date: Fri, 17 Feb 2023 22:32:46 -0500
Subject: [PATCH] readd tas2559 in dts

---
 .../boot/dts/qcom/sdm845-xiaomi-polaris.dts   | 110 ++++++++++++++++++
 1 file changed, 110 insertions(+)

diff --git a/arch/arm64/boot/dts/qcom/sdm845-xiaomi-polaris.dts b/arch/arm64/boot/dts/qcom/sdm845-xiaomi-polaris.dts
index dba7c2693..bd9e5430f 100644
--- a/arch/arm64/boot/dts/qcom/sdm845-xiaomi-polaris.dts
+++ b/arch/arm64/boot/dts/qcom/sdm845-xiaomi-polaris.dts
@@ -12,6 +12,7 @@
 #include <dt-bindings/input/linux-event-codes.h>
 #include <dt-bindings/sound/qcom,q6afe.h>
 #include <dt-bindings/sound/qcom,q6asm.h>
+#include <dt-bindings/sound/qcom,q6voice.h>
 #include "sdm845.dtsi"
 #include "pm8998.dtsi"
 #include "pmi8998.dtsi"
@@ -454,6 +455,24 @@
        status = "okay";
 };

+&i2c5 {
+       clock-frequency = <400000>;
+       dmas = <&gpi_dma0 0 5 QCOM_GPI_I2C>,
+                  <&gpi_dma0 1 5 QCOM_GPI_I2C>;
+       dma-names = "tx", "rx";
+       status = "okay";
+
+       tas2559_codec: codec@4c{
+               #sound-dai-cells = <1>;
+               compatible = "ti,tas2559";
+               reg = <0x4c>;
+               ti,tas2559-reset-gpio = <&tlmm 14 0>;
+               ti,tas2560-reset-gpio = <&tlmm 25 0>;
+               ti,tas2559-addr = <0x4c>;
+               ti,tas2560-addr = <0x4d>;
+       };
+};
+
 &i2c14 {
        clock-frequency = <400000>;
        dmas = <&gpi_dma1 0 6 QCOM_GPI_I2C>,
@@ -580,6 +599,97 @@
        };
 };

+&slpi_pas {
+       firmware-name = "qcom/sdm845/polaris/slpi.mbn";
+       status = "okay";
+};
+
+&sound {
+       compatible = "qcom,db845c-sndcard";
+       pinctrl-0 = <&quat_mi2s_active
+                       &quat_mi2s_sd0_active>;
+       pinctrl-names = "default";
+       model = "Xiaomi Mi Mix2S";
+       audio-routing =
+               "RX_BIAS", "MCLK",
+               "AMIC1", "MIC BIAS1",
+               "AMIC2", "MIC BIAS2",
+               "AMIC3", "MIC BIAS3";
+
+       mm1-dai-link {
+               link-name = "MultiMedia1";
+               cpu {
+                       sound-dai = <&q6asmdai  MSM_FRONTEND_DAI_MULTIMEDIA1>;
+               };
+       };
+
+       mm2-dai-link {
+               link-name = "MultiMedia2";
+               cpu {
+                       sound-dai = <&q6asmdai  MSM_FRONTEND_DAI_MULTIMEDIA2>;
+               };
+       };
+
+       mm3-dai-link {
+               link-name = "MultiMedia3";
+               cpu {
+                       sound-dai = <&q6asmdai  MSM_FRONTEND_DAI_MULTIMEDIA3>;
+               };
+       };
+
+       dai-link-voicemmode1 {
+               link-name = "VoiceMMode1";
+               cpu {
+                       sound-dai = <&q6voicedai VOICEMMODE1>;
+               };
+       };
+
+       tas2559-dai-link {
+               link-name = "Primary Spkr Playback";
+               cpu {
+                       sound-dai = <&q6afedai QUATERNARY_MI2S_RX>;
+               };
+
+               platform {
+                       sound-dai = <&q6routing>;
+               };
+
+               codec {
+                       sound-dai =  <&tas2559_codec 0>;
+               };
+       };
+
+       slim-dai-link {
+               link-name = "SLIM Playback";
+               cpu {
+                       sound-dai = <&q6afedai SLIMBUS_0_RX>;
+               };
+
+               platform {
+                       sound-dai = <&q6routing>;
+               };
+
+               codec {
+                       sound-dai =  <&wcd9340 0>;
+               };
+       };
+
+       slimcap-dai-link {
+               link-name = "SLIM Capture";
+               cpu {
+                       sound-dai = <&q6afedai SLIMBUS_0_TX>;
+               };
+
+               platform {
+                       sound-dai = <&q6routing>;
+               };
+
+               codec {
+                       sound-dai = <&wcd9340 1>;
+               };
+       };
+};
+
 &tlmm {
        gpio-reserved-ranges = <0 4>, <81 4>;

--
2.20.1
